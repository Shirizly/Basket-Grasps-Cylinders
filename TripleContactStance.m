function [p1,ph1,p2,ph2v,p3,h] = TripleContactStance(ph1,t,base,height,slope,r,hcm)
syms ph2
vx = [1;0;0];
vy = [0;cos(t);sin(t)];
vz = [0;-sin(t);cos(t)];
com = [0;0;hcm];
Rt = [vx vy vz];
com = Rt*com;
h = [];
% At first construct the points without ds1. 
% later add it to make the third contact
po1 = [0;0;hcm]+r*[sin(ph1);cos(ph1);0];
p1 = Rt*po1;
ds2 = (r*cos(ph1)*sin(t) - r*cos(ph2)*sin(t))/cos(t);
% ds2 = (cos(t)*(ds1) + r*cos(ph1)*sin(t) - r*cos(ph2)*sin(t))/cos(t);
po2 = [0;0;hcm+ds2]+r*[sin(ph2);cos(ph2);0];
p2 = Rt*po2;
% eq2_baselength = (p2(1:2)-p1(1:2)).'*(p2(1:2)-p1(1:2)) == base^2;
f2_baselength = matlabFunction((p2(1:2)-p1(1:2)).'*(p2(1:2)-p1(1:2)) - base^2);

% ph2s = phsolve(ph1,r,base,t);
% ph2v = wrapToPi(double(solve(eq2_baselength,ph2,'Real',true)));
options = optimoptions('fsolve','Display','none');
ph2v = wrapToPi(fsolve(f2_baselength,2*pi()-ph1,options));
% ph2v(abs(ph2v)<pi()/2)=[];
% if mod(ph1,2*pi)<pi
%     ph2_index = find(mod(ph2v,2*pi)>pi());
% else
%     ph2_index = find(mod(ph2v,2*pi)<pi());
% end
% if isempty(ph2_index)
%     ph2_index = find(abs(ph2v)==max(abs(ph2v)));
% end
% ph2v = ph2v(ph2_index);
switch length(ph2v)==1
    case 1
        p2 = double(subs(p2,ph2,ph2v));
    case {2,3,4}
        disp('issue with multiple solutions');
    case 0
%         disp('issue with no solution');
        p3 = inf;
        return
end
base_vector = p1-p2;
base_middle = (p1+p2)/2;
p1x = p1(1);
p1y = p1(2);
p1z = p1(3);
p2x = p2(1);
p2y = p2(2);
p2z = p2(3);
p3v = cell(0);
  
p3v{1} = double([(p1x^2 - p2x^2 + p1y^2 - p2y^2)/(2*(p1x - p2x)) - ((p1y - p2y)*(p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y^3 + p2y^3 - 2*((height^2*p1x^4 + height^2*p2x^4 - 4*height^2*p1x*p2x^3 - 4*height^2*p1x^3*p2x + 6*height^2*p1x^2*p2x^2 + height^2*p1x^2*p1y^2 + height^2*p1x^2*p2y^2 + height^2*p2x^2*p1y^2 + height^2*p2x^2*p2y^2 - height^2*p1x^2*p1z^2*slope^2 - height^2*p1x^2*p2z^2*slope^2 - height^2*p2x^2*p1z^2*slope^2 - height^2*p2x^2*p2z^2*slope^2 - height^2*p1y^2*p1z^2*slope^2 - height^2*p1y^2*p2z^2*slope^2 - height^2*p2y^2*p1z^2*slope^2 - height^2*p2y^2*p2z^2*slope^2 - 2*height^2*p1x*p2x*p1y^2 - 2*height^2*p1x*p2x*p2y^2 - 2*height^2*p1x^2*p1y*p2y - 2*height^2*p2x^2*p1y*p2y + (height^2*p1y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^4)/(slope^2 + 1) + 2*height^2*p1x*p2x*p1z^2*slope^2 + 2*height^2*p1x*p2x*p2z^2*slope^2 + 2*height^2*p1y*p2y*p1z^2*slope^2 + 2*height^2*p1x^2*p1z*p2z*slope^2 + 2*height^2*p1y*p2y*p2z^2*slope^2 + 2*height^2*p2x^2*p1z*p2z*slope^2 + 2*height^2*p1y^2*p1z*p2z*slope^2 + 2*height^2*p2y^2*p1z*p2z*slope^2 + 4*height^2*p1x*p2x*p1y*p2y - (2*height^2*p1y*p2y*p1z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p1z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^4)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^4)/(slope^2 + 1) - 4*height^2*p1x*p2x*p1z*p2z*slope^2 - 4*height^2*p1y*p2y*p1z*p2z*slope^2 + (4*height^2*p1y*p2y*p1z*p2z*slope^2)/(slope^2 + 1) + (4*height^2*p1y*p2y*p1z*p2z*slope^4)/(slope^2 + 1))/(slope^2 + 1))^(1/2) - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y - 2*height*p1y*p1z*slope*(1/(slope^2 + 1))^(1/2) + 2*height*p1y*p2z*slope*(1/(slope^2 + 1))^(1/2) + 2*height*p2y*p1z*slope*(1/(slope^2 + 1))^(1/2) - 2*height*p2y*p2z*slope*(1/(slope^2 + 1))^(1/2)))/(2*(p1x - p2x)*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2)) - (height*slope*(1/(slope^2 + 1))^(1/2)*(p1z - p2z))/(p1x - p2x);...
                                                                                                                                              (p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y^3 + p2y^3 - 2*((height^2*p1x^4 + height^2*p2x^4 - 4*height^2*p1x*p2x^3 - 4*height^2*p1x^3*p2x + 6*height^2*p1x^2*p2x^2 + height^2*p1x^2*p1y^2 + height^2*p1x^2*p2y^2 + height^2*p2x^2*p1y^2 + height^2*p2x^2*p2y^2 - height^2*p1x^2*p1z^2*slope^2 - height^2*p1x^2*p2z^2*slope^2 - height^2*p2x^2*p1z^2*slope^2 - height^2*p2x^2*p2z^2*slope^2 - height^2*p1y^2*p1z^2*slope^2 - height^2*p1y^2*p2z^2*slope^2 - height^2*p2y^2*p1z^2*slope^2 - height^2*p2y^2*p2z^2*slope^2 - 2*height^2*p1x*p2x*p1y^2 - 2*height^2*p1x*p2x*p2y^2 - 2*height^2*p1x^2*p1y*p2y - 2*height^2*p2x^2*p1y*p2y + (height^2*p1y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^4)/(slope^2 + 1) + 2*height^2*p1x*p2x*p1z^2*slope^2 + 2*height^2*p1x*p2x*p2z^2*slope^2 + 2*height^2*p1y*p2y*p1z^2*slope^2 + 2*height^2*p1x^2*p1z*p2z*slope^2 + 2*height^2*p1y*p2y*p2z^2*slope^2 + 2*height^2*p2x^2*p1z*p2z*slope^2 + 2*height^2*p1y^2*p1z*p2z*slope^2 + 2*height^2*p2y^2*p1z*p2z*slope^2 + 4*height^2*p1x*p2x*p1y*p2y - (2*height^2*p1y*p2y*p1z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p1z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^4)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^4)/(slope^2 + 1) - 4*height^2*p1x*p2x*p1z*p2z*slope^2 - 4*height^2*p1y*p2y*p1z*p2z*slope^2 + (4*height^2*p1y*p2y*p1z*p2z*slope^2)/(slope^2 + 1) + (4*height^2*p1y*p2y*p1z*p2z*slope^4)/(slope^2 + 1))/(slope^2 + 1))^(1/2) - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y - 2*height*p1y*p1z*slope*(1/(slope^2 + 1))^(1/2) + 2*height*p1y*p2z*slope*(1/(slope^2 + 1))^(1/2) + 2*height*p2y*p1z*slope*(1/(slope^2 + 1))^(1/2) - 2*height*p2y*p2z*slope*(1/(slope^2 + 1))^(1/2))/(2*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2));...
         p1z/2 + p2z/2 + height*slope*(1/(slope^2 + 1))^(1/2)]);
 
 
p3v{2} = double([(p1x^2 - p2x^2 + p1y^2 - p2y^2)/(2*(p1x - p2x)) - ((p1y - p2y)*(p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y^3 + p2y^3 + 2*((height^2*p1x^4 + height^2*p2x^4 - 4*height^2*p1x*p2x^3 - 4*height^2*p1x^3*p2x + 6*height^2*p1x^2*p2x^2 + height^2*p1x^2*p1y^2 + height^2*p1x^2*p2y^2 + height^2*p2x^2*p1y^2 + height^2*p2x^2*p2y^2 - height^2*p1x^2*p1z^2*slope^2 - height^2*p1x^2*p2z^2*slope^2 - height^2*p2x^2*p1z^2*slope^2 - height^2*p2x^2*p2z^2*slope^2 - height^2*p1y^2*p1z^2*slope^2 - height^2*p1y^2*p2z^2*slope^2 - height^2*p2y^2*p1z^2*slope^2 - height^2*p2y^2*p2z^2*slope^2 - 2*height^2*p1x*p2x*p1y^2 - 2*height^2*p1x*p2x*p2y^2 - 2*height^2*p1x^2*p1y*p2y - 2*height^2*p2x^2*p1y*p2y + (height^2*p1y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^4)/(slope^2 + 1) + 2*height^2*p1x*p2x*p1z^2*slope^2 + 2*height^2*p1x*p2x*p2z^2*slope^2 + 2*height^2*p1y*p2y*p1z^2*slope^2 + 2*height^2*p1x^2*p1z*p2z*slope^2 + 2*height^2*p1y*p2y*p2z^2*slope^2 + 2*height^2*p2x^2*p1z*p2z*slope^2 + 2*height^2*p1y^2*p1z*p2z*slope^2 + 2*height^2*p2y^2*p1z*p2z*slope^2 + 4*height^2*p1x*p2x*p1y*p2y - (2*height^2*p1y*p2y*p1z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p1z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^4)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^4)/(slope^2 + 1) - 4*height^2*p1x*p2x*p1z*p2z*slope^2 - 4*height^2*p1y*p2y*p1z*p2z*slope^2 + (4*height^2*p1y*p2y*p1z*p2z*slope^2)/(slope^2 + 1) + (4*height^2*p1y*p2y*p1z*p2z*slope^4)/(slope^2 + 1))/(slope^2 + 1))^(1/2) - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y - 2*height*p1y*p1z*slope*(1/(slope^2 + 1))^(1/2) + 2*height*p1y*p2z*slope*(1/(slope^2 + 1))^(1/2) + 2*height*p2y*p1z*slope*(1/(slope^2 + 1))^(1/2) - 2*height*p2y*p2z*slope*(1/(slope^2 + 1))^(1/2)))/(2*(p1x - p2x)*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2)) - (height*slope*(1/(slope^2 + 1))^(1/2)*(p1z - p2z))/(p1x - p2x);...
                                                                                                                                              (p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y^3 + p2y^3 + 2*((height^2*p1x^4 + height^2*p2x^4 - 4*height^2*p1x*p2x^3 - 4*height^2*p1x^3*p2x + 6*height^2*p1x^2*p2x^2 + height^2*p1x^2*p1y^2 + height^2*p1x^2*p2y^2 + height^2*p2x^2*p1y^2 + height^2*p2x^2*p2y^2 - height^2*p1x^2*p1z^2*slope^2 - height^2*p1x^2*p2z^2*slope^2 - height^2*p2x^2*p1z^2*slope^2 - height^2*p2x^2*p2z^2*slope^2 - height^2*p1y^2*p1z^2*slope^2 - height^2*p1y^2*p2z^2*slope^2 - height^2*p2y^2*p1z^2*slope^2 - height^2*p2y^2*p2z^2*slope^2 - 2*height^2*p1x*p2x*p1y^2 - 2*height^2*p1x*p2x*p2y^2 - 2*height^2*p1x^2*p1y*p2y - 2*height^2*p2x^2*p1y*p2y + (height^2*p1y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^4)/(slope^2 + 1) + 2*height^2*p1x*p2x*p1z^2*slope^2 + 2*height^2*p1x*p2x*p2z^2*slope^2 + 2*height^2*p1y*p2y*p1z^2*slope^2 + 2*height^2*p1x^2*p1z*p2z*slope^2 + 2*height^2*p1y*p2y*p2z^2*slope^2 + 2*height^2*p2x^2*p1z*p2z*slope^2 + 2*height^2*p1y^2*p1z*p2z*slope^2 + 2*height^2*p2y^2*p1z*p2z*slope^2 + 4*height^2*p1x*p2x*p1y*p2y - (2*height^2*p1y*p2y*p1z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p1z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^4)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^4)/(slope^2 + 1) - 4*height^2*p1x*p2x*p1z*p2z*slope^2 - 4*height^2*p1y*p2y*p1z*p2z*slope^2 + (4*height^2*p1y*p2y*p1z*p2z*slope^2)/(slope^2 + 1) + (4*height^2*p1y*p2y*p1z*p2z*slope^4)/(slope^2 + 1))/(slope^2 + 1))^(1/2) - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y - 2*height*p1y*p1z*slope*(1/(slope^2 + 1))^(1/2) + 2*height*p1y*p2z*slope*(1/(slope^2 + 1))^(1/2) + 2*height*p2y*p1z*slope*(1/(slope^2 + 1))^(1/2) - 2*height*p2y*p2z*slope*(1/(slope^2 + 1))^(1/2))/(2*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2));...
        p1z/2 + p2z/2 + height*slope*(1/(slope^2 + 1))^(1/2)]);
 
 
p3v{3} = double([(p1x^2 - p2x^2 + p1y^2 - p2y^2)/(2*(p1x - p2x)) - ((p1y - p2y)*(p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y^3 + p2y^3 - 2*((height^2*p1x^4 + height^2*p2x^4 - 4*height^2*p1x*p2x^3 - 4*height^2*p1x^3*p2x + 6*height^2*p1x^2*p2x^2 + height^2*p1x^2*p1y^2 + height^2*p1x^2*p2y^2 + height^2*p2x^2*p1y^2 + height^2*p2x^2*p2y^2 - height^2*p1x^2*p1z^2*slope^2 - height^2*p1x^2*p2z^2*slope^2 - height^2*p2x^2*p1z^2*slope^2 - height^2*p2x^2*p2z^2*slope^2 - height^2*p1y^2*p1z^2*slope^2 - height^2*p1y^2*p2z^2*slope^2 - height^2*p2y^2*p1z^2*slope^2 - height^2*p2y^2*p2z^2*slope^2 - 2*height^2*p1x*p2x*p1y^2 - 2*height^2*p1x*p2x*p2y^2 - 2*height^2*p1x^2*p1y*p2y - 2*height^2*p2x^2*p1y*p2y + (height^2*p1y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^4)/(slope^2 + 1) + 2*height^2*p1x*p2x*p1z^2*slope^2 + 2*height^2*p1x*p2x*p2z^2*slope^2 + 2*height^2*p1y*p2y*p1z^2*slope^2 + 2*height^2*p1x^2*p1z*p2z*slope^2 + 2*height^2*p1y*p2y*p2z^2*slope^2 + 2*height^2*p2x^2*p1z*p2z*slope^2 + 2*height^2*p1y^2*p1z*p2z*slope^2 + 2*height^2*p2y^2*p1z*p2z*slope^2 + 4*height^2*p1x*p2x*p1y*p2y - (2*height^2*p1y*p2y*p1z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p1z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^4)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^4)/(slope^2 + 1) - 4*height^2*p1x*p2x*p1z*p2z*slope^2 - 4*height^2*p1y*p2y*p1z*p2z*slope^2 + (4*height^2*p1y*p2y*p1z*p2z*slope^2)/(slope^2 + 1) + (4*height^2*p1y*p2y*p1z*p2z*slope^4)/(slope^2 + 1))/(slope^2 + 1))^(1/2) - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y + 2*height*p1y*p1z*slope*(1/(slope^2 + 1))^(1/2) - 2*height*p1y*p2z*slope*(1/(slope^2 + 1))^(1/2) - 2*height*p2y*p1z*slope*(1/(slope^2 + 1))^(1/2) + 2*height*p2y*p2z*slope*(1/(slope^2 + 1))^(1/2)))/(2*(p1x - p2x)*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2)) + (height*slope*(1/(slope^2 + 1))^(1/2)*(p1z - p2z))/(p1x - p2x);...
                                                                                                                                              (p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y^3 + p2y^3 - 2*((height^2*p1x^4 + height^2*p2x^4 - 4*height^2*p1x*p2x^3 - 4*height^2*p1x^3*p2x + 6*height^2*p1x^2*p2x^2 + height^2*p1x^2*p1y^2 + height^2*p1x^2*p2y^2 + height^2*p2x^2*p1y^2 + height^2*p2x^2*p2y^2 - height^2*p1x^2*p1z^2*slope^2 - height^2*p1x^2*p2z^2*slope^2 - height^2*p2x^2*p1z^2*slope^2 - height^2*p2x^2*p2z^2*slope^2 - height^2*p1y^2*p1z^2*slope^2 - height^2*p1y^2*p2z^2*slope^2 - height^2*p2y^2*p1z^2*slope^2 - height^2*p2y^2*p2z^2*slope^2 - 2*height^2*p1x*p2x*p1y^2 - 2*height^2*p1x*p2x*p2y^2 - 2*height^2*p1x^2*p1y*p2y - 2*height^2*p2x^2*p1y*p2y + (height^2*p1y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^4)/(slope^2 + 1) + 2*height^2*p1x*p2x*p1z^2*slope^2 + 2*height^2*p1x*p2x*p2z^2*slope^2 + 2*height^2*p1y*p2y*p1z^2*slope^2 + 2*height^2*p1x^2*p1z*p2z*slope^2 + 2*height^2*p1y*p2y*p2z^2*slope^2 + 2*height^2*p2x^2*p1z*p2z*slope^2 + 2*height^2*p1y^2*p1z*p2z*slope^2 + 2*height^2*p2y^2*p1z*p2z*slope^2 + 4*height^2*p1x*p2x*p1y*p2y - (2*height^2*p1y*p2y*p1z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p1z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^4)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^4)/(slope^2 + 1) - 4*height^2*p1x*p2x*p1z*p2z*slope^2 - 4*height^2*p1y*p2y*p1z*p2z*slope^2 + (4*height^2*p1y*p2y*p1z*p2z*slope^2)/(slope^2 + 1) + (4*height^2*p1y*p2y*p1z*p2z*slope^4)/(slope^2 + 1))/(slope^2 + 1))^(1/2) - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y + 2*height*p1y*p1z*slope*(1/(slope^2 + 1))^(1/2) - 2*height*p1y*p2z*slope*(1/(slope^2 + 1))^(1/2) - 2*height*p2y*p1z*slope*(1/(slope^2 + 1))^(1/2) + 2*height*p2y*p2z*slope*(1/(slope^2 + 1))^(1/2))/(2*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2));...
        p1z/2 + p2z/2 - height*slope*(1/(slope^2 + 1))^(1/2)]);
 
 
p3v{4} = double([(p1x^2 - p2x^2 + p1y^2 - p2y^2)/(2*(p1x - p2x)) - ((p1y - p2y)*(p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y^3 + p2y^3 + 2*((height^2*p1x^4 + height^2*p2x^4 - 4*height^2*p1x*p2x^3 - 4*height^2*p1x^3*p2x + 6*height^2*p1x^2*p2x^2 + height^2*p1x^2*p1y^2 + height^2*p1x^2*p2y^2 + height^2*p2x^2*p1y^2 + height^2*p2x^2*p2y^2 - height^2*p1x^2*p1z^2*slope^2 - height^2*p1x^2*p2z^2*slope^2 - height^2*p2x^2*p1z^2*slope^2 - height^2*p2x^2*p2z^2*slope^2 - height^2*p1y^2*p1z^2*slope^2 - height^2*p1y^2*p2z^2*slope^2 - height^2*p2y^2*p1z^2*slope^2 - height^2*p2y^2*p2z^2*slope^2 - 2*height^2*p1x*p2x*p1y^2 - 2*height^2*p1x*p2x*p2y^2 - 2*height^2*p1x^2*p1y*p2y - 2*height^2*p2x^2*p1y*p2y + (height^2*p1y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^4)/(slope^2 + 1) + 2*height^2*p1x*p2x*p1z^2*slope^2 + 2*height^2*p1x*p2x*p2z^2*slope^2 + 2*height^2*p1y*p2y*p1z^2*slope^2 + 2*height^2*p1x^2*p1z*p2z*slope^2 + 2*height^2*p1y*p2y*p2z^2*slope^2 + 2*height^2*p2x^2*p1z*p2z*slope^2 + 2*height^2*p1y^2*p1z*p2z*slope^2 + 2*height^2*p2y^2*p1z*p2z*slope^2 + 4*height^2*p1x*p2x*p1y*p2y - (2*height^2*p1y*p2y*p1z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p1z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^4)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^4)/(slope^2 + 1) - 4*height^2*p1x*p2x*p1z*p2z*slope^2 - 4*height^2*p1y*p2y*p1z*p2z*slope^2 + (4*height^2*p1y*p2y*p1z*p2z*slope^2)/(slope^2 + 1) + (4*height^2*p1y*p2y*p1z*p2z*slope^4)/(slope^2 + 1))/(slope^2 + 1))^(1/2) - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y + 2*height*p1y*p1z*slope*(1/(slope^2 + 1))^(1/2) - 2*height*p1y*p2z*slope*(1/(slope^2 + 1))^(1/2) - 2*height*p2y*p1z*slope*(1/(slope^2 + 1))^(1/2) + 2*height*p2y*p2z*slope*(1/(slope^2 + 1))^(1/2)))/(2*(p1x - p2x)*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2)) + (height*slope*(1/(slope^2 + 1))^(1/2)*(p1z - p2z))/(p1x - p2x);...
                                                                                                                                              (p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y^3 + p2y^3 + 2*((height^2*p1x^4 + height^2*p2x^4 - 4*height^2*p1x*p2x^3 - 4*height^2*p1x^3*p2x + 6*height^2*p1x^2*p2x^2 + height^2*p1x^2*p1y^2 + height^2*p1x^2*p2y^2 + height^2*p2x^2*p1y^2 + height^2*p2x^2*p2y^2 - height^2*p1x^2*p1z^2*slope^2 - height^2*p1x^2*p2z^2*slope^2 - height^2*p2x^2*p1z^2*slope^2 - height^2*p2x^2*p2z^2*slope^2 - height^2*p1y^2*p1z^2*slope^2 - height^2*p1y^2*p2z^2*slope^2 - height^2*p2y^2*p1z^2*slope^2 - height^2*p2y^2*p2z^2*slope^2 - 2*height^2*p1x*p2x*p1y^2 - 2*height^2*p1x*p2x*p2y^2 - 2*height^2*p1x^2*p1y*p2y - 2*height^2*p2x^2*p1y*p2y + (height^2*p1y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^2)/(slope^2 + 1) + (height^2*p1y^2*p2z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p1z^2*slope^4)/(slope^2 + 1) + (height^2*p2y^2*p2z^2*slope^4)/(slope^2 + 1) + 2*height^2*p1x*p2x*p1z^2*slope^2 + 2*height^2*p1x*p2x*p2z^2*slope^2 + 2*height^2*p1y*p2y*p1z^2*slope^2 + 2*height^2*p1x^2*p1z*p2z*slope^2 + 2*height^2*p1y*p2y*p2z^2*slope^2 + 2*height^2*p2x^2*p1z*p2z*slope^2 + 2*height^2*p1y^2*p1z*p2z*slope^2 + 2*height^2*p2y^2*p1z*p2z*slope^2 + 4*height^2*p1x*p2x*p1y*p2y - (2*height^2*p1y*p2y*p1z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^2)/(slope^2 + 1) - (2*height^2*p1y*p2y*p1z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y*p2y*p2z^2*slope^4)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^2)/(slope^2 + 1) - (2*height^2*p1y^2*p1z*p2z*slope^4)/(slope^2 + 1) - (2*height^2*p2y^2*p1z*p2z*slope^4)/(slope^2 + 1) - 4*height^2*p1x*p2x*p1z*p2z*slope^2 - 4*height^2*p1y*p2y*p1z*p2z*slope^2 + (4*height^2*p1y*p2y*p1z*p2z*slope^2)/(slope^2 + 1) + (4*height^2*p1y*p2y*p1z*p2z*slope^4)/(slope^2 + 1))/(slope^2 + 1))^(1/2) - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y + 2*height*p1y*p1z*slope*(1/(slope^2 + 1))^(1/2) - 2*height*p1y*p2z*slope*(1/(slope^2 + 1))^(1/2) - 2*height*p2y*p1z*slope*(1/(slope^2 + 1))^(1/2) + 2*height*p2y*p2z*slope*(1/(slope^2 + 1))^(1/2))/(2*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2));...
        p1z/2 + p2z/2 - height*slope*(1/(slope^2 + 1))^(1/2)]);
 

    p1corrected = cell(0); p2corrected = cell(0); p3corrected = cell(0);
for i=1:4
    p3vi = p3v{i};
    n3 = [0,-sin(t),cos(t)].';
    dist3 = n3.'*p3vi;
    p3vicorrected = p3vi-n3*dist3;
    base_middlec = base_middle-n3*dist3;
    v2p3c = base_middlec-p3vicorrected;
    slopec = v2p3c(3)/(v2p3c(1)^2+v2p3c(2)^2)^0.5;
    if norm(p3vicorrected)<=r && abs(slopec-slope)<1E-5
    p3corrected{end+1} = p3vicorrected;
    p1corrected{end+1} = p1-n3*dist3;
    p2corrected{end+1} = p2-n3*dist3;
    end
end
if numel(p1corrected)>1
    notOver = 1; i=1;
%     while notOver
%         if p1corrected{i}(3)<0 || p2corrected{i}(3)<0
%             p1corrected(i)=[];
%             p2corrected(i)=[];
%             i = i-1;
%         end
%         i=i+1;
%         if i>numel(p1corrected)
%             notOver = 0;
%         end
%     end
    p1t = p1corrected{1};
    p2t = p2corrected{1};
    p3t = p3corrected{1};
    removed = [];
    for i=2:numel(p1corrected)
        if norm(p1corrected{i}-p1t)+norm(p2corrected{i}-p2t)+norm(p3corrected{i}-p3t)<1E-6
            removed = [removed i];
        end
    end
    p1corrected(removed) = [];
end
if numel(p1corrected)==0
    p3 = inf;
    return
end
if numel(p1corrected)==1
    p1 = p1corrected{1};
    p2 = p2corrected{1};
    p3 = p3corrected{1};
else
    disp('multiple solutions found');
end
h = com(3)-p3(3);
end


%% mistaken development of p3 with slope as z/(x^2+y^2):
% p3v{1} = [(p1x^2 - p2x^2 + p1y^2 - p2y^2 + p1z^2 - p2z^2)/(2*(p1x - p2x)) - ((p1y - p2y)*((-(2*p1x^4*p1z + 2*p1x^4*p2z + 2*p2x^4*p1z + 2*p2x^4*p2z + 2*p1x^2*p1z^3 + 2*p1x^2*p2z^3 + 2*p2x^2*p1z^3 + 2*p2x^2*p2z^3 + 2*p1y^2*p1z^3 + 2*p1y^2*p2z^3 + 2*p2y^2*p1z^3 + 2*p2y^2*p2z^3 - 4*p1x*p2x*p1z^3 - 8*p1x*p2x^3*p1z - 8*p1x^3*p2x*p1z - 4*p1x*p2x*p2z^3 - 8*p1x*p2x^3*p2z - 8*p1x^3*p2x*p2z - 4*p1y*p2y*p1z^3 - 4*p1y*p2y*p2z^3 + 12*p1x^2*p2x^2*p1z + 12*p1x^2*p2x^2*p2z + 2*p1x^2*p1y^2*p1z + 2*p1x^2*p1y^2*p2z + 2*p1x^2*p2y^2*p1z + 2*p2x^2*p1y^2*p1z + 2*p1x^2*p2y^2*p2z + 2*p2x^2*p1y^2*p2z + 2*p2x^2*p2y^2*p1z + 2*p2x^2*p2y^2*p2z - 2*p1x^2*p1z*p2z^2 - 2*p1x^2*p1z^2*p2z - 2*p2x^2*p1z*p2z^2 - 2*p2x^2*p1z^2*p2z - 2*p1y^2*p1z*p2z^2 - 2*p1y^2*p1z^2*p2z - 2*p2y^2*p1z*p2z^2 - 2*p2y^2*p1z^2*p2z - p1y^2*p1z^4*slope - p1y^2*p2z^4*slope - p2y^2*p1z^4*slope - p2y^2*p2z^4*slope + 2*p1y^2*p1z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p1y^2*p2z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p1z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p2z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - (2*p1x^4*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^4*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 4*p1y*p2y*p1z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 4*p1y*p2y*p2z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - (p1y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p1y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 4*height^2*p1x^2*p1z^2*slope + 4*height^2*p1x^2*p2z^2*slope + 4*height^2*p2x^2*p1z^2*slope + 4*height^2*p2x^2*p2z^2*slope + 4*height^2*p1y^2*p1z^2*slope + 4*height^2*p1y^2*p2z^2*slope + 4*height^2*p2y^2*p1z^2*slope + 4*height^2*p2y^2*p2z^2*slope + 2*p1y^2*p1z^2*p2z^2*slope + 2*p2y^2*p1z^2*p2z^2*slope - 2*p1y^2*p1z*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p1y^2*p1z^2*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z^2*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + (8*p1x*p2x^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (8*p1x^3*p2x*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 4*p1x*p2x*p1y^2*p1z - 4*p1x*p2x*p1y^2*p2z - 4*p1x*p2x*p2y^2*p1z - 4*p1x*p2x*p2y^2*p2z - 4*p1x^2*p1y*p2y*p1z + 4*p1x*p2x*p1z*p2z^2 + 4*p1x*p2x*p1z^2*p2z - 4*p1x^2*p1y*p2y*p2z - 4*p2x^2*p1y*p2y*p1z - 4*p2x^2*p1y*p2y*p2z + 4*p1y*p2y*p1z*p2z^2 + 4*p1y*p2y*p1z^2*p2z + 2*p1y*p2y*p1z^4*slope + 2*p1y*p2y*p2z^4*slope - (12*p1x^2*p2x^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (2*p1y*p2y*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y*p2y*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p2y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - 8*height^2*p1x*p2x*p1z^2*slope - 8*height^2*p1x*p2x*p2z^2*slope - 8*height^2*p1y*p2y*p1z^2*slope - 8*height^2*p1x^2*p1z*p2z*slope - 8*height^2*p1y*p2y*p2z^2*slope - 8*height^2*p2x^2*p1z*p2z*slope - 8*height^2*p1y^2*p1z*p2z*slope - 8*height^2*p2y^2*p1z*p2z*slope - 4*p1y*p2y*p1z^2*p2z^2*slope + 4*p1y*p2y*p1z*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 4*p1y*p2y*p1z^2*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 8*p1x*p2x*p1y*p2y*p1z + 8*p1x*p2x*p1y*p2y*p2z + (4*p1x*p2x*p1y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1y*p2y*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1y*p2y*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (4*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 16*height^2*p1x*p2x*p1z*p2z*slope + 16*height^2*p1y*p2y*p1z*p2z*slope - (8*p1x*p2x*p1y*p2y*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1x*p2x*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope)/slope)^(1/2) + p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y*p1z^2 - p1y*p2z^2 - p2y*p1z^2 + p2y*p2z^2 + p1y^3 + p2y^3 - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y - (p1y*p1z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p1y*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p2y*p1z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (p2y*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope))/(2*(p1x - p2x)*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2)) - ((p1z - p2z)*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/(2*slope*(p1x - p2x));...
%         ((-(2*p1x^4*p1z + 2*p1x^4*p2z + 2*p2x^4*p1z + 2*p2x^4*p2z + 2*p1x^2*p1z^3 + 2*p1x^2*p2z^3 + 2*p2x^2*p1z^3 + 2*p2x^2*p2z^3 + 2*p1y^2*p1z^3 + 2*p1y^2*p2z^3 + 2*p2y^2*p1z^3 + 2*p2y^2*p2z^3 - 4*p1x*p2x*p1z^3 - 8*p1x*p2x^3*p1z - 8*p1x^3*p2x*p1z - 4*p1x*p2x*p2z^3 - 8*p1x*p2x^3*p2z - 8*p1x^3*p2x*p2z - 4*p1y*p2y*p1z^3 - 4*p1y*p2y*p2z^3 + 12*p1x^2*p2x^2*p1z + 12*p1x^2*p2x^2*p2z + 2*p1x^2*p1y^2*p1z + 2*p1x^2*p1y^2*p2z + 2*p1x^2*p2y^2*p1z + 2*p2x^2*p1y^2*p1z + 2*p1x^2*p2y^2*p2z + 2*p2x^2*p1y^2*p2z + 2*p2x^2*p2y^2*p1z + 2*p2x^2*p2y^2*p2z - 2*p1x^2*p1z*p2z^2 - 2*p1x^2*p1z^2*p2z - 2*p2x^2*p1z*p2z^2 - 2*p2x^2*p1z^2*p2z - 2*p1y^2*p1z*p2z^2 - 2*p1y^2*p1z^2*p2z - 2*p2y^2*p1z*p2z^2 - 2*p2y^2*p1z^2*p2z - p1y^2*p1z^4*slope - p1y^2*p2z^4*slope - p2y^2*p1z^4*slope - p2y^2*p2z^4*slope + 2*p1y^2*p1z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p1y^2*p2z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p1z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p2z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - (2*p1x^4*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^4*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 4*p1y*p2y*p1z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 4*p1y*p2y*p2z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - (p1y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p1y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 4*height^2*p1x^2*p1z^2*slope + 4*height^2*p1x^2*p2z^2*slope + 4*height^2*p2x^2*p1z^2*slope + 4*height^2*p2x^2*p2z^2*slope + 4*height^2*p1y^2*p1z^2*slope + 4*height^2*p1y^2*p2z^2*slope + 4*height^2*p2y^2*p1z^2*slope + 4*height^2*p2y^2*p2z^2*slope + 2*p1y^2*p1z^2*p2z^2*slope + 2*p2y^2*p1z^2*p2z^2*slope - 2*p1y^2*p1z*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p1y^2*p1z^2*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z^2*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + (8*p1x*p2x^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (8*p1x^3*p2x*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 4*p1x*p2x*p1y^2*p1z - 4*p1x*p2x*p1y^2*p2z - 4*p1x*p2x*p2y^2*p1z - 4*p1x*p2x*p2y^2*p2z - 4*p1x^2*p1y*p2y*p1z + 4*p1x*p2x*p1z*p2z^2 + 4*p1x*p2x*p1z^2*p2z - 4*p1x^2*p1y*p2y*p2z - 4*p2x^2*p1y*p2y*p1z - 4*p2x^2*p1y*p2y*p2z + 4*p1y*p2y*p1z*p2z^2 + 4*p1y*p2y*p1z^2*p2z + 2*p1y*p2y*p1z^4*slope + 2*p1y*p2y*p2z^4*slope - (12*p1x^2*p2x^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (2*p1y*p2y*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y*p2y*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p2y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - 8*height^2*p1x*p2x*p1z^2*slope - 8*height^2*p1x*p2x*p2z^2*slope - 8*height^2*p1y*p2y*p1z^2*slope - 8*height^2*p1x^2*p1z*p2z*slope - 8*height^2*p1y*p2y*p2z^2*slope - 8*height^2*p2x^2*p1z*p2z*slope - 8*height^2*p1y^2*p1z*p2z*slope - 8*height^2*p2y^2*p1z*p2z*slope - 4*p1y*p2y*p1z^2*p2z^2*slope + 4*p1y*p2y*p1z*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 4*p1y*p2y*p1z^2*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 8*p1x*p2x*p1y*p2y*p1z + 8*p1x*p2x*p1y*p2y*p2z + (4*p1x*p2x*p1y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1y*p2y*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1y*p2y*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (4*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 16*height^2*p1x*p2x*p1z*p2z*slope + 16*height^2*p1y*p2y*p1z*p2z*slope - (8*p1x*p2x*p1y*p2y*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1x*p2x*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope)/slope)^(1/2) + p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y*p1z^2 - p1y*p2z^2 - p2y*p1z^2 + p2y*p2z^2 + p1y^3 + p2y^3 - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y - (p1y*p1z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p1y*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p2y*p1z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (p2y*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope)/(2*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2));...
%         (p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)/(2*slope)];
% 
% p3v{2} = [(p1x^2 - p2x^2 + p1y^2 - p2y^2 + p1z^2 - p2z^2)/(2*(p1x - p2x)) - ((p1z - p2z)*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/(2*slope*(p1x - p2x)) - ((p1y - p2y)*(p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y*p1z^2 - p1y*p2z^2 - p2y*p1z^2 + p2y*p2z^2 - (-(2*p1x^4*p1z + 2*p1x^4*p2z + 2*p2x^4*p1z + 2*p2x^4*p2z + 2*p1x^2*p1z^3 + 2*p1x^2*p2z^3 + 2*p2x^2*p1z^3 + 2*p2x^2*p2z^3 + 2*p1y^2*p1z^3 + 2*p1y^2*p2z^3 + 2*p2y^2*p1z^3 + 2*p2y^2*p2z^3 - 4*p1x*p2x*p1z^3 - 8*p1x*p2x^3*p1z - 8*p1x^3*p2x*p1z - 4*p1x*p2x*p2z^3 - 8*p1x*p2x^3*p2z - 8*p1x^3*p2x*p2z - 4*p1y*p2y*p1z^3 - 4*p1y*p2y*p2z^3 + 12*p1x^2*p2x^2*p1z + 12*p1x^2*p2x^2*p2z + 2*p1x^2*p1y^2*p1z + 2*p1x^2*p1y^2*p2z + 2*p1x^2*p2y^2*p1z + 2*p2x^2*p1y^2*p1z + 2*p1x^2*p2y^2*p2z + 2*p2x^2*p1y^2*p2z + 2*p2x^2*p2y^2*p1z + 2*p2x^2*p2y^2*p2z - 2*p1x^2*p1z*p2z^2 - 2*p1x^2*p1z^2*p2z - 2*p2x^2*p1z*p2z^2 - 2*p2x^2*p1z^2*p2z - 2*p1y^2*p1z*p2z^2 - 2*p1y^2*p1z^2*p2z - 2*p2y^2*p1z*p2z^2 - 2*p2y^2*p1z^2*p2z - p1y^2*p1z^4*slope - p1y^2*p2z^4*slope - p2y^2*p1z^4*slope - p2y^2*p2z^4*slope + 2*p1y^2*p1z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p1y^2*p2z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p1z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p2z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - (2*p1x^4*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^4*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 2*p1y^2*p1z*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p1y^2*p1z^2*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z^2*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + (8*p1x*p2x^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (8*p1x^3*p2x*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + 4*height^2*p1x^2*p1z^2*slope + 4*height^2*p1x^2*p2z^2*slope + 4*height^2*p2x^2*p1z^2*slope + 4*height^2*p2x^2*p2z^2*slope + 4*height^2*p1y^2*p1z^2*slope + 4*height^2*p1y^2*p2z^2*slope + 4*height^2*p2y^2*p1z^2*slope + 4*height^2*p2y^2*p2z^2*slope + 2*p1y^2*p1z^2*p2z^2*slope + 2*p2y^2*p1z^2*p2z^2*slope - (12*p1x^2*p2x^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 4*p1x*p2x*p1y^2*p1z - 4*p1x*p2x*p1y^2*p2z - 4*p1x*p2x*p2y^2*p1z - 4*p1x*p2x*p2y^2*p2z - 4*p1x^2*p1y*p2y*p1z + 4*p1x*p2x*p1z*p2z^2 + 4*p1x*p2x*p1z^2*p2z - 4*p1x^2*p1y*p2y*p2z - 4*p2x^2*p1y*p2y*p1z - 4*p2x^2*p1y*p2y*p2z + 4*p1y*p2y*p1z*p2z^2 + 4*p1y*p2y*p1z^2*p2z + 2*p1y*p2y*p1z^4*slope + 2*p1y*p2y*p2z^4*slope - 4*p1y*p2y*p1z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 4*p1y*p2y*p2z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - (p1y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p1y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 4*p1y*p2y*p1z*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 4*p1y*p2y*p1z^2*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 8*height^2*p1x*p2x*p1z^2*slope - 8*height^2*p1x*p2x*p2z^2*slope - 8*height^2*p1y*p2y*p1z^2*slope - 8*height^2*p1x^2*p1z*p2z*slope - 8*height^2*p1y*p2y*p2z^2*slope - 8*height^2*p2x^2*p1z*p2z*slope - 8*height^2*p1y^2*p1z*p2z*slope - 8*height^2*p2y^2*p1z*p2z*slope - 4*p1y*p2y*p1z^2*p2z^2*slope + (4*p1x*p2x*p1y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1y*p2y*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1y*p2y*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + 8*p1x*p2x*p1y*p2y*p1z + 8*p1x*p2x*p1y*p2y*p2z + (2*p1y*p2y*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y*p2y*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p2y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 16*height^2*p1x*p2x*p1z*p2z*slope + 16*height^2*p1y*p2y*p1z*p2z*slope - (8*p1x*p2x*p1y*p2y*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1x*p2x*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (4*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope)/slope)^(1/2) + p1y^3 + p2y^3 - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y - (p1y*p1z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p1y*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p2y*p1z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (p2y*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope))/(2*(p1x - p2x)*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2));...
%                                                                                                                                                                                                 (p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y*p1z^2 - p1y*p2z^2 - p2y*p1z^2 + p2y*p2z^2 - (-(2*p1x^4*p1z + 2*p1x^4*p2z + 2*p2x^4*p1z + 2*p2x^4*p2z + 2*p1x^2*p1z^3 + 2*p1x^2*p2z^3 + 2*p2x^2*p1z^3 + 2*p2x^2*p2z^3 + 2*p1y^2*p1z^3 + 2*p1y^2*p2z^3 + 2*p2y^2*p1z^3 + 2*p2y^2*p2z^3 - 4*p1x*p2x*p1z^3 - 8*p1x*p2x^3*p1z - 8*p1x^3*p2x*p1z - 4*p1x*p2x*p2z^3 - 8*p1x*p2x^3*p2z - 8*p1x^3*p2x*p2z - 4*p1y*p2y*p1z^3 - 4*p1y*p2y*p2z^3 + 12*p1x^2*p2x^2*p1z + 12*p1x^2*p2x^2*p2z + 2*p1x^2*p1y^2*p1z + 2*p1x^2*p1y^2*p2z + 2*p1x^2*p2y^2*p1z + 2*p2x^2*p1y^2*p1z + 2*p1x^2*p2y^2*p2z + 2*p2x^2*p1y^2*p2z + 2*p2x^2*p2y^2*p1z + 2*p2x^2*p2y^2*p2z - 2*p1x^2*p1z*p2z^2 - 2*p1x^2*p1z^2*p2z - 2*p2x^2*p1z*p2z^2 - 2*p2x^2*p1z^2*p2z - 2*p1y^2*p1z*p2z^2 - 2*p1y^2*p1z^2*p2z - 2*p2y^2*p1z*p2z^2 - 2*p2y^2*p1z^2*p2z - p1y^2*p1z^4*slope - p1y^2*p2z^4*slope - p2y^2*p1z^4*slope - p2y^2*p2z^4*slope + 2*p1y^2*p1z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p1y^2*p2z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p1z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p2z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - (2*p1x^4*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^4*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 2*p1y^2*p1z*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p1y^2*p1z^2*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z^2*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + (8*p1x*p2x^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (8*p1x^3*p2x*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + 4*height^2*p1x^2*p1z^2*slope + 4*height^2*p1x^2*p2z^2*slope + 4*height^2*p2x^2*p1z^2*slope + 4*height^2*p2x^2*p2z^2*slope + 4*height^2*p1y^2*p1z^2*slope + 4*height^2*p1y^2*p2z^2*slope + 4*height^2*p2y^2*p1z^2*slope + 4*height^2*p2y^2*p2z^2*slope + 2*p1y^2*p1z^2*p2z^2*slope + 2*p2y^2*p1z^2*p2z^2*slope - (12*p1x^2*p2x^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 4*p1x*p2x*p1y^2*p1z - 4*p1x*p2x*p1y^2*p2z - 4*p1x*p2x*p2y^2*p1z - 4*p1x*p2x*p2y^2*p2z - 4*p1x^2*p1y*p2y*p1z + 4*p1x*p2x*p1z*p2z^2 + 4*p1x*p2x*p1z^2*p2z - 4*p1x^2*p1y*p2y*p2z - 4*p2x^2*p1y*p2y*p1z - 4*p2x^2*p1y*p2y*p2z + 4*p1y*p2y*p1z*p2z^2 + 4*p1y*p2y*p1z^2*p2z + 2*p1y*p2y*p1z^4*slope + 2*p1y*p2y*p2z^4*slope - 4*p1y*p2y*p1z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 4*p1y*p2y*p2z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - (p1y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p1y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 4*p1y*p2y*p1z*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 4*p1y*p2y*p1z^2*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 8*height^2*p1x*p2x*p1z^2*slope - 8*height^2*p1x*p2x*p2z^2*slope - 8*height^2*p1y*p2y*p1z^2*slope - 8*height^2*p1x^2*p1z*p2z*slope - 8*height^2*p1y*p2y*p2z^2*slope - 8*height^2*p2x^2*p1z*p2z*slope - 8*height^2*p1y^2*p1z*p2z*slope - 8*height^2*p2y^2*p1z*p2z*slope - 4*p1y*p2y*p1z^2*p2z^2*slope + (4*p1x*p2x*p1y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1y*p2y*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1y*p2y*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + 8*p1x*p2x*p1y*p2y*p1z + 8*p1x*p2x*p1y*p2y*p2z + (2*p1y*p2y*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y*p2y*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p2y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 16*height^2*p1x*p2x*p1z*p2z*slope + 16*height^2*p1y*p2y*p1z*p2z*slope - (8*p1x*p2x*p1y*p2y*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1x*p2x*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (4*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope)/slope)^(1/2) + p1y^3 + p2y^3 - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y - (p1y*p1z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p1y*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p2y*p1z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (p2y*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope)/(2*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2));...
%         (p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)/(2*slope)];
% 
% p3v{3} = [(p1x^2 - p2x^2 + p1y^2 - p2y^2 + p1z^2 - p2z^2)/(2*(p1x - p2x)) - ((p1y - p2y)*(p1x^2*p1y - (-(2*p1x^4*p1z + 2*p1x^4*p2z + 2*p2x^4*p1z + 2*p2x^4*p2z + 2*p1x^2*p1z^3 + 2*p1x^2*p2z^3 + 2*p2x^2*p1z^3 + 2*p2x^2*p2z^3 + 2*p1y^2*p1z^3 + 2*p1y^2*p2z^3 + 2*p2y^2*p1z^3 + 2*p2y^2*p2z^3 - 4*p1x*p2x*p1z^3 - 8*p1x*p2x^3*p1z - 8*p1x^3*p2x*p1z - 4*p1x*p2x*p2z^3 - 8*p1x*p2x^3*p2z - 8*p1x^3*p2x*p2z - 4*p1y*p2y*p1z^3 - 4*p1y*p2y*p2z^3 + 12*p1x^2*p2x^2*p1z + 12*p1x^2*p2x^2*p2z + 2*p1x^2*p1y^2*p1z + 2*p1x^2*p1y^2*p2z + 2*p1x^2*p2y^2*p1z + 2*p2x^2*p1y^2*p1z + 2*p1x^2*p2y^2*p2z + 2*p2x^2*p1y^2*p2z + 2*p2x^2*p2y^2*p1z + 2*p2x^2*p2y^2*p2z - 2*p1x^2*p1z*p2z^2 - 2*p1x^2*p1z^2*p2z - 2*p2x^2*p1z*p2z^2 - 2*p2x^2*p1z^2*p2z - 2*p1y^2*p1z*p2z^2 - 2*p1y^2*p1z^2*p2z - 2*p2y^2*p1z*p2z^2 - 2*p2y^2*p1z^2*p2z - p1y^2*p1z^4*slope - p1y^2*p2z^4*slope - p2y^2*p1z^4*slope - p2y^2*p2z^4*slope + 2*p1y^2*p1z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p1y^2*p2z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p1z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p2z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - (2*p1x^4*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^4*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 4*p1y*p2y*p1z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 4*p1y*p2y*p2z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - (p1y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p1y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 4*height^2*p1x^2*p1z^2*slope + 4*height^2*p1x^2*p2z^2*slope + 4*height^2*p2x^2*p1z^2*slope + 4*height^2*p2x^2*p2z^2*slope + 4*height^2*p1y^2*p1z^2*slope + 4*height^2*p1y^2*p2z^2*slope + 4*height^2*p2y^2*p1z^2*slope + 4*height^2*p2y^2*p2z^2*slope + 2*p1y^2*p1z^2*p2z^2*slope + 2*p2y^2*p1z^2*p2z^2*slope - 2*p1y^2*p1z*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p1y^2*p1z^2*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z^2*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + (8*p1x*p2x^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (8*p1x^3*p2x*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 4*p1x*p2x*p1y^2*p1z - 4*p1x*p2x*p1y^2*p2z - 4*p1x*p2x*p2y^2*p1z - 4*p1x*p2x*p2y^2*p2z - 4*p1x^2*p1y*p2y*p1z + 4*p1x*p2x*p1z*p2z^2 + 4*p1x*p2x*p1z^2*p2z - 4*p1x^2*p1y*p2y*p2z - 4*p2x^2*p1y*p2y*p1z - 4*p2x^2*p1y*p2y*p2z + 4*p1y*p2y*p1z*p2z^2 + 4*p1y*p2y*p1z^2*p2z + 2*p1y*p2y*p1z^4*slope + 2*p1y*p2y*p2z^4*slope - (12*p1x^2*p2x^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (2*p1y*p2y*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y*p2y*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p2y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - 8*height^2*p1x*p2x*p1z^2*slope - 8*height^2*p1x*p2x*p2z^2*slope - 8*height^2*p1y*p2y*p1z^2*slope - 8*height^2*p1x^2*p1z*p2z*slope - 8*height^2*p1y*p2y*p2z^2*slope - 8*height^2*p2x^2*p1z*p2z*slope - 8*height^2*p1y^2*p1z*p2z*slope - 8*height^2*p2y^2*p1z*p2z*slope - 4*p1y*p2y*p1z^2*p2z^2*slope + 4*p1y*p2y*p1z*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 4*p1y*p2y*p1z^2*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 8*p1x*p2x*p1y*p2y*p1z + 8*p1x*p2x*p1y*p2y*p2z + (4*p1x*p2x*p1y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1y*p2y*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1y*p2y*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (4*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 16*height^2*p1x*p2x*p1z*p2z*slope + 16*height^2*p1y*p2y*p1z*p2z*slope - (8*p1x*p2x*p1y*p2y*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1x*p2x*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope)/slope)^(1/2) + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y*p1z^2 - p1y*p2z^2 - p2y*p1z^2 + p2y*p2z^2 + p1y^3 + p2y^3 - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y - (p1y*p1z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p1y*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p2y*p1z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (p2y*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope))/(2*(p1x - p2x)*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2)) - ((p1z - p2z)*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/(2*slope*(p1x - p2x));...
%                                                                                                                                                                                                 (p1x^2*p1y - (-(2*p1x^4*p1z + 2*p1x^4*p2z + 2*p2x^4*p1z + 2*p2x^4*p2z + 2*p1x^2*p1z^3 + 2*p1x^2*p2z^3 + 2*p2x^2*p1z^3 + 2*p2x^2*p2z^3 + 2*p1y^2*p1z^3 + 2*p1y^2*p2z^3 + 2*p2y^2*p1z^3 + 2*p2y^2*p2z^3 - 4*p1x*p2x*p1z^3 - 8*p1x*p2x^3*p1z - 8*p1x^3*p2x*p1z - 4*p1x*p2x*p2z^3 - 8*p1x*p2x^3*p2z - 8*p1x^3*p2x*p2z - 4*p1y*p2y*p1z^3 - 4*p1y*p2y*p2z^3 + 12*p1x^2*p2x^2*p1z + 12*p1x^2*p2x^2*p2z + 2*p1x^2*p1y^2*p1z + 2*p1x^2*p1y^2*p2z + 2*p1x^2*p2y^2*p1z + 2*p2x^2*p1y^2*p1z + 2*p1x^2*p2y^2*p2z + 2*p2x^2*p1y^2*p2z + 2*p2x^2*p2y^2*p1z + 2*p2x^2*p2y^2*p2z - 2*p1x^2*p1z*p2z^2 - 2*p1x^2*p1z^2*p2z - 2*p2x^2*p1z*p2z^2 - 2*p2x^2*p1z^2*p2z - 2*p1y^2*p1z*p2z^2 - 2*p1y^2*p1z^2*p2z - 2*p2y^2*p1z*p2z^2 - 2*p2y^2*p1z^2*p2z - p1y^2*p1z^4*slope - p1y^2*p2z^4*slope - p2y^2*p1z^4*slope - p2y^2*p2z^4*slope + 2*p1y^2*p1z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p1y^2*p2z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p1z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p2z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - (2*p1x^4*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^4*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 4*p1y*p2y*p1z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 4*p1y*p2y*p2z^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - (p1y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p1y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 4*height^2*p1x^2*p1z^2*slope + 4*height^2*p1x^2*p2z^2*slope + 4*height^2*p2x^2*p1z^2*slope + 4*height^2*p2x^2*p2z^2*slope + 4*height^2*p1y^2*p1z^2*slope + 4*height^2*p1y^2*p2z^2*slope + 4*height^2*p2y^2*p1z^2*slope + 4*height^2*p2y^2*p2z^2*slope + 2*p1y^2*p1z^2*p2z^2*slope + 2*p2y^2*p1z^2*p2z^2*slope - 2*p1y^2*p1z*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p1y^2*p1z^2*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z^2*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + (8*p1x*p2x^3*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (8*p1x^3*p2x*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 4*p1x*p2x*p1y^2*p1z - 4*p1x*p2x*p1y^2*p2z - 4*p1x*p2x*p2y^2*p1z - 4*p1x*p2x*p2y^2*p2z - 4*p1x^2*p1y*p2y*p1z + 4*p1x*p2x*p1z*p2z^2 + 4*p1x*p2x*p1z^2*p2z - 4*p1x^2*p1y*p2y*p2z - 4*p2x^2*p1y*p2y*p1z - 4*p2x^2*p1y*p2y*p2z + 4*p1y*p2y*p1z*p2z^2 + 4*p1y*p2y*p1z^2*p2z + 2*p1y*p2y*p1z^4*slope + 2*p1y*p2y*p2z^4*slope - (12*p1x^2*p2x^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (2*p1y*p2y*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y*p2y*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p2y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - 8*height^2*p1x*p2x*p1z^2*slope - 8*height^2*p1x*p2x*p2z^2*slope - 8*height^2*p1y*p2y*p1z^2*slope - 8*height^2*p1x^2*p1z*p2z*slope - 8*height^2*p1y*p2y*p2z^2*slope - 8*height^2*p2x^2*p1z*p2z*slope - 8*height^2*p1y^2*p1z*p2z*slope - 8*height^2*p2y^2*p1z*p2z*slope - 4*p1y*p2y*p1z^2*p2z^2*slope + 4*p1y*p2y*p1z*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 4*p1y*p2y*p1z^2*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1) + 8*p1x*p2x*p1y*p2y*p1z + 8*p1x*p2x*p1y*p2y*p2z + (4*p1x*p2x*p1y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2y^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1y*p2y*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1y*p2y*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p1z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p2z^2*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2y^2*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (4*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 16*height^2*p1x*p2x*p1z*p2z*slope + 16*height^2*p1y*p2y*p1z*p2z*slope - (8*p1x*p2x*p1y*p2y*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1x*p2x*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope)/slope)^(1/2) + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y*p1z^2 - p1y*p2z^2 - p2y*p1z^2 + p2y*p2z^2 + p1y^3 + p2y^3 - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y - (p1y*p1z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p1y*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p2y*p1z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (p2y*p2z*(p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1))/slope)/(2*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2));...
%         (p1z*slope + p2z*slope - (4*height^2*slope^2 + 1)^(1/2) - 1)/(2*slope)];
% 
% p3v{4} = [(p1x^2 - p2x^2 + p1y^2 - p2y^2 + p1z^2 - p2z^2)/(2*(p1x - p2x)) - ((p1z - p2z)*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/(2*slope*(p1x - p2x)) - ((p1y - p2y)*(p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y*p1z^2 - p1y*p2z^2 - p2y*p1z^2 + p2y*p2z^2 + (-(2*p1x^4*p1z + 2*p1x^4*p2z + 2*p2x^4*p1z + 2*p2x^4*p2z + 2*p1x^2*p1z^3 + 2*p1x^2*p2z^3 + 2*p2x^2*p1z^3 + 2*p2x^2*p2z^3 + 2*p1y^2*p1z^3 + 2*p1y^2*p2z^3 + 2*p2y^2*p1z^3 + 2*p2y^2*p2z^3 - 4*p1x*p2x*p1z^3 - 8*p1x*p2x^3*p1z - 8*p1x^3*p2x*p1z - 4*p1x*p2x*p2z^3 - 8*p1x*p2x^3*p2z - 8*p1x^3*p2x*p2z - 4*p1y*p2y*p1z^3 - 4*p1y*p2y*p2z^3 + 12*p1x^2*p2x^2*p1z + 12*p1x^2*p2x^2*p2z + 2*p1x^2*p1y^2*p1z + 2*p1x^2*p1y^2*p2z + 2*p1x^2*p2y^2*p1z + 2*p2x^2*p1y^2*p1z + 2*p1x^2*p2y^2*p2z + 2*p2x^2*p1y^2*p2z + 2*p2x^2*p2y^2*p1z + 2*p2x^2*p2y^2*p2z - 2*p1x^2*p1z*p2z^2 - 2*p1x^2*p1z^2*p2z - 2*p2x^2*p1z*p2z^2 - 2*p2x^2*p1z^2*p2z - 2*p1y^2*p1z*p2z^2 - 2*p1y^2*p1z^2*p2z - 2*p2y^2*p1z*p2z^2 - 2*p2y^2*p1z^2*p2z - p1y^2*p1z^4*slope - p1y^2*p2z^4*slope - p2y^2*p1z^4*slope - p2y^2*p2z^4*slope + 2*p1y^2*p1z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p1y^2*p2z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p1z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p2z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - (2*p1x^4*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^4*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 2*p1y^2*p1z*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p1y^2*p1z^2*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z^2*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + (8*p1x*p2x^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (8*p1x^3*p2x*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + 4*height^2*p1x^2*p1z^2*slope + 4*height^2*p1x^2*p2z^2*slope + 4*height^2*p2x^2*p1z^2*slope + 4*height^2*p2x^2*p2z^2*slope + 4*height^2*p1y^2*p1z^2*slope + 4*height^2*p1y^2*p2z^2*slope + 4*height^2*p2y^2*p1z^2*slope + 4*height^2*p2y^2*p2z^2*slope + 2*p1y^2*p1z^2*p2z^2*slope + 2*p2y^2*p1z^2*p2z^2*slope - (12*p1x^2*p2x^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 4*p1x*p2x*p1y^2*p1z - 4*p1x*p2x*p1y^2*p2z - 4*p1x*p2x*p2y^2*p1z - 4*p1x*p2x*p2y^2*p2z - 4*p1x^2*p1y*p2y*p1z + 4*p1x*p2x*p1z*p2z^2 + 4*p1x*p2x*p1z^2*p2z - 4*p1x^2*p1y*p2y*p2z - 4*p2x^2*p1y*p2y*p1z - 4*p2x^2*p1y*p2y*p2z + 4*p1y*p2y*p1z*p2z^2 + 4*p1y*p2y*p1z^2*p2z + 2*p1y*p2y*p1z^4*slope + 2*p1y*p2y*p2z^4*slope - 4*p1y*p2y*p1z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 4*p1y*p2y*p2z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - (p1y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p1y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 4*p1y*p2y*p1z*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 4*p1y*p2y*p1z^2*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 8*height^2*p1x*p2x*p1z^2*slope - 8*height^2*p1x*p2x*p2z^2*slope - 8*height^2*p1y*p2y*p1z^2*slope - 8*height^2*p1x^2*p1z*p2z*slope - 8*height^2*p1y*p2y*p2z^2*slope - 8*height^2*p2x^2*p1z*p2z*slope - 8*height^2*p1y^2*p1z*p2z*slope - 8*height^2*p2y^2*p1z*p2z*slope - 4*p1y*p2y*p1z^2*p2z^2*slope + (4*p1x*p2x*p1y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1y*p2y*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1y*p2y*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + 8*p1x*p2x*p1y*p2y*p1z + 8*p1x*p2x*p1y*p2y*p2z + (2*p1y*p2y*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y*p2y*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p2y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 16*height^2*p1x*p2x*p1z*p2z*slope + 16*height^2*p1y*p2y*p1z*p2z*slope - (8*p1x*p2x*p1y*p2y*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1x*p2x*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (4*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope)/slope)^(1/2) + p1y^3 + p2y^3 - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y - (p1y*p1z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p1y*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p2y*p1z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (p2y*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope))/(2*(p1x - p2x)*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2));...
%                                                                                                                                                                                                 (p1x^2*p1y + p1x^2*p2y + p2x^2*p1y + p2x^2*p2y - p1y*p2y^2 - p1y^2*p2y + p1y*p1z^2 - p1y*p2z^2 - p2y*p1z^2 + p2y*p2z^2 + (-(2*p1x^4*p1z + 2*p1x^4*p2z + 2*p2x^4*p1z + 2*p2x^4*p2z + 2*p1x^2*p1z^3 + 2*p1x^2*p2z^3 + 2*p2x^2*p1z^3 + 2*p2x^2*p2z^3 + 2*p1y^2*p1z^3 + 2*p1y^2*p2z^3 + 2*p2y^2*p1z^3 + 2*p2y^2*p2z^3 - 4*p1x*p2x*p1z^3 - 8*p1x*p2x^3*p1z - 8*p1x^3*p2x*p1z - 4*p1x*p2x*p2z^3 - 8*p1x*p2x^3*p2z - 8*p1x^3*p2x*p2z - 4*p1y*p2y*p1z^3 - 4*p1y*p2y*p2z^3 + 12*p1x^2*p2x^2*p1z + 12*p1x^2*p2x^2*p2z + 2*p1x^2*p1y^2*p1z + 2*p1x^2*p1y^2*p2z + 2*p1x^2*p2y^2*p1z + 2*p2x^2*p1y^2*p1z + 2*p1x^2*p2y^2*p2z + 2*p2x^2*p1y^2*p2z + 2*p2x^2*p2y^2*p1z + 2*p2x^2*p2y^2*p2z - 2*p1x^2*p1z*p2z^2 - 2*p1x^2*p1z^2*p2z - 2*p2x^2*p1z*p2z^2 - 2*p2x^2*p1z^2*p2z - 2*p1y^2*p1z*p2z^2 - 2*p1y^2*p1z^2*p2z - 2*p2y^2*p1z*p2z^2 - 2*p2y^2*p1z^2*p2z - p1y^2*p1z^4*slope - p1y^2*p2z^4*slope - p2y^2*p1z^4*slope - p2y^2*p2z^4*slope + 2*p1y^2*p1z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p1y^2*p2z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p1z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 2*p2y^2*p2z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - (2*p1x^4*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^4*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 2*p1y^2*p1z*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p1y^2*p1z^2*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 2*p2y^2*p1z^2*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + (8*p1x*p2x^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (8*p1x^3*p2x*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + 4*height^2*p1x^2*p1z^2*slope + 4*height^2*p1x^2*p2z^2*slope + 4*height^2*p2x^2*p1z^2*slope + 4*height^2*p2x^2*p2z^2*slope + 4*height^2*p1y^2*p1z^2*slope + 4*height^2*p1y^2*p2z^2*slope + 4*height^2*p2y^2*p1z^2*slope + 4*height^2*p2y^2*p2z^2*slope + 2*p1y^2*p1z^2*p2z^2*slope + 2*p2y^2*p1z^2*p2z^2*slope - (12*p1x^2*p2x^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1x^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2x^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p1y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (2*p2y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - 4*p1x*p2x*p1y^2*p1z - 4*p1x*p2x*p1y^2*p2z - 4*p1x*p2x*p2y^2*p1z - 4*p1x*p2x*p2y^2*p2z - 4*p1x^2*p1y*p2y*p1z + 4*p1x*p2x*p1z*p2z^2 + 4*p1x*p2x*p1z^2*p2z - 4*p1x^2*p1y*p2y*p2z - 4*p2x^2*p1y*p2y*p1z - 4*p2x^2*p1y*p2y*p2z + 4*p1y*p2y*p1z*p2z^2 + 4*p1y*p2y*p1z^2*p2z + 2*p1y*p2y*p1z^4*slope + 2*p1y*p2y*p2z^4*slope - 4*p1y*p2y*p1z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 4*p1y*p2y*p2z^3*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - (p1y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p1y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope - (p2y^2*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 4*p1y*p2y*p1z*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) + 4*p1y*p2y*p1z^2*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1) - 8*height^2*p1x*p2x*p1z^2*slope - 8*height^2*p1x*p2x*p2z^2*slope - 8*height^2*p1y*p2y*p1z^2*slope - 8*height^2*p1x^2*p1z*p2z*slope - 8*height^2*p1y*p2y*p2z^2*slope - 8*height^2*p2x^2*p1z*p2z*slope - 8*height^2*p1y^2*p1z*p2z*slope - 8*height^2*p2y^2*p1z*p2z*slope - 4*p1y*p2y*p1z^2*p2z^2*slope + (4*p1x*p2x*p1y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2y^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1y*p2y*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x*p2x*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1y*p2y*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1x^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y*p2y*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2x^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p1y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (4*p2y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + 8*p1x*p2x*p1y*p2y*p1z + 8*p1x*p2x*p1y*p2y*p2z + (2*p1y*p2y*p1z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y*p2y*p2z^2*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p1y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + (2*p2y^2*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope + 16*height^2*p1x*p2x*p1z*p2z*slope + 16*height^2*p1y*p2y*p1z*p2z*slope - (8*p1x*p2x*p1y*p2y*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1x*p2x*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (8*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (4*p1y*p2y*p1z*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)^2)/slope)/slope)^(1/2) + p1y^3 + p2y^3 - 2*p1x*p2x*p1y - 2*p1x*p2x*p2y - (p1y*p1z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p1y*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope + (p2y*p1z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope - (p2y*p2z*(p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1))/slope)/(2*(p1x^2 - 2*p1x*p2x + p2x^2 + p1y^2 - 2*p1y*p2y + p2y^2));...
%         (p1z*slope + p2z*slope + (4*height^2*slope^2 + 1)^(1/2) - 1)/(2*slope)];